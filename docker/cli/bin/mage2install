#!/bin/bash

[ "$DEBUG" = "true" ] && set -x

# Ensure our Magento directory exists
mkdir -p $MAGENTO_ROOT

if [ -n "$MAGE2_PARAMS" ]; then
    echo "Mage2 Installation Started..."

    MAGE2_PARAMS=$(sed "s/^[\"\']|[\"\']$//g" <<< "$MAGE2_PARAMS")

    if [ "$MAGE2_USE_SAMPLE_DATA" = "true" ]; then
        echo "Deploy Sample Data..."
        magento sampledata:deploy
        MAGE2_PARAMS="$MAGE2_PARAMS --use-sample-data"
    fi

    INSTALL_CMD="magento setup:install $MAGE2_PARAMS"
    $INSTALL_CMD

    if [ "$MAGE2_VARNISH_FPC" = "true" ]; then
        magento config:set --scope=default --scope-code=0 system/full_page_cache/caching_application 2
        magento setup:config:set --http-cache-hosts=varnish
    fi

    echo "Mage2 Installation Complete!"
else
    echo "Skipping Mage2 Installation..."
fi
